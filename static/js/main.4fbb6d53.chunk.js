(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{203:function(e,t,n){},205:function(e,t,n){"use strict";n.r(t);var r=n(0),o=n.n(r),a=n(19),s=n.n(a),i=(n(84),n(9)),c=n(10),l=n(12),u=n(11),p=n(13),h=n(29),d=n.n(h),m=n(44),b=n(28),f=n(20),w=n(2),g=function(e){function t(){return Object(i.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t=this.props.treeIds,n=this.props.treeDict;return o.a.createElement(f.b,{type:"symbol",id:"trees",layout:{"icon-image":"billy"}},t.map(function(t){return o.a.createElement(f.a,{onMouseEnter:e.props.onTreeHover.bind(e,t),onMouseLeave:e.props.onTreeEndHover.bind(e),coordinates:n[t].geometry.coordinates,onClick:e.props.onTreeClick.bind(null,t),key:t})}))}}]),t}(r.Component),v=function(e){function t(){return Object(i.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props.hoveredTree,t=this.props.onPopUpClick;return o.a.createElement(f.c,{key:e.recordid,coordinates:e.geometry.coordinates,offset:15,onClick:t},o.a.createElement("div",null,o.a.createElement("h3",null,e.fields.libellefrancais),o.a.createElement("div",null,"Esp\xe8ce : ",e.fields.espece),o.a.createElement("div",null,"Genre : ",e.fields.genre),e.fields.dateplantation?o.a.createElement("div",null," Ann\xe9e de plantation : ",e.fields.dateplantation.substr(0,4)," "):null))}}]),t}(r.Component),j=n(78),D=n(47),y=n.n(D),k=function(e){function t(){return Object(i.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement(y.a,{open:this.props.leftDrawer,onClose:this.props.toggleDrawer},o.a.createElement("div",{tabIndex:0,role:"button",onClick:this.props.toggleDrawer,onKeyDown:this.props.toggleDrawer})),o.a.createElement(y.a,{anchor:"bottom",open:this.props.bottomDrawer,onClose:this.props.toggleDrawer},o.a.createElement("div",{tabIndex:0,role:"button",onClick:this.props.toggleDrawer,onKeyDown:this.props.toggleDrawer},o.a.createElement("img",{src:this.props.thumbnailUrl,alt:"Thubnail"}),o.a.createElement("p",null,this.props.wikiDesc))))}}]),t}(o.a.Component),O=Object(j.withStyles)({list:{width:250},fullList:{width:"auto"}})(k),E=n(48),T=Object(f.d)({minZoom:11,maxZoom:16,accessToken:E.b}),C=E.a,x={speed:.6},I=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).onMapLoad=function(e){e.addControl(new w.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!1}))},n.onTreeHover=function(e,t){t.map.getCanvas().style.cursor="pointer",n.setState({hoveredTreeID:e})},n.onTreeEndHover=function(e){e.map.getCanvas().style.cursor="",n.setState({hoveredTreeID:""})},n.onTreeClick=function(e){n.setState({hoveredTreeID:e,bottomDrawer:!0});var t=n.state.treeDict[e].fields.libellefrancais;console.log("species",t),n.wikiTreeData(t)},n.onPopUpClick=function(){n.setState({hoveredTreeID:""})},n.toggleDrawer=function(){n.setState({bottomDrawer:!1,thumbnailUrl:""})},n.TreeData=Object(m.a)(d.a.mark(function e(){var t,r,o,a,s;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,fetch("https://opendata.paris.fr/api/records/1.0/search/?dataset=arbresremarquablesparis&rows=200");case 3:return r=e.sent,e.next=6,r.json();case 6:for(o=e.sent,a=Math.min(o.parameters.rows,o.nhits),s=0;s<a;s++)t.push(s);return e.abrupt("return",n.setState({treeDict:o.records,nbTrees:a,treeIds:t},function(){console.log("dict",this.state.treeDict),console.log("nb",this.state.nbTrees),console.log("ids",this.state.treeIds)}));case 10:case"end":return e.stop()}},e,this)})),n.wikiTreeData=function(){var e=Object(m.a)(d.a.mark(function e(t){var r,o,a,s,i,c,l,u,p,h,m,b,f;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.split(" ").join("_"),e.next=3,fetch("https://fr.wikipedia.org/w/api.php?action=opensearch&search=".concat(r,"&format=json&redirects=resolve&origin=*"));case 3:return o=e.sent,e.next=6,o.json();case 6:return a=e.sent,e.next=9,a[3][0];case 9:return s=e.sent,console.log("Best result",s),i=s.split("/").slice(-1)[0],console.log("Best result title",i),e.next=15,fetch("https://fr.wikipedia.org/w/api.php?format=json&action=query&prop=extracts&exintro&explaintext&redirects=1&titles=".concat(i,"&origin=*"));case 15:return c=e.sent,e.next=18,c.json();case 18:return l=e.sent,console.log("descQuery Json",l),u=l.query.pages,console.log("Pages",u),p=u[Object.keys(u)[0]].extract,console.log("desc",p),e.next=26,fetch("https://fr.wikipedia.org/w/api.php?action=query&prop=pageimages&titles=".concat(i,"&format=json&pithumbsize=200&origin=*"));case 26:return h=e.sent,e.next=29,h.json();case 29:return m=e.sent,console.log("thumbQuery Json",m),b=m.query.pages,console.log("Pages",b),f=b[Object.keys(b)[0]].thumbnail.source,console.log("Thumbnail",f),e.abrupt("return",n.setState({wikiDesc:p,thumbnailUrl:f},function(){console.log("wikiData",this.state.thumbnailUrl)}));case 36:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),n.state={treeDict:"",nbTrees:0,treeIds:[],hoveredTreeID:"",mapCenter:[2.3466110229492188,48.85613168160397],zoom:[12],leftDrawer:!1,bottomDrawer:!1,wikiTreeData:"",thumbnailUrl:"",wikiDesc:""},n.toggleDrawer=n.toggleDrawer.bind(Object(b.a)(Object(b.a)(n))),n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.TreeData()}},{key:"render",value:function(){var e=this.state.hoveredTreeID,t=this.state.mapCenter,n=this.state.zoom;return o.a.createElement("div",null,o.a.createElement(T,{onStyleLoad:this.onMapLoad,style:C,center:t,containerStyle:{width:"100vw",height:"100vh"},flyToOptions:x,zoom:n},o.a.createElement(g,{onTreeHover:this.onTreeHover,onTreeEndHover:this.onTreeEndHover,treeIds:this.state.treeIds,treeDict:this.state.treeDict,onTreeClick:this.onTreeClick}),e&&o.a.createElement(v,{hoveredTree:this.state.treeDict[e],onPopUpClick:this.onPopUpClick})),o.a.createElement(O,{wikiDesc:this.state.wikiDesc,thumbnailUrl:this.state.thumbnailUrl,leftDrawer:this.state.leftDrawer,bottomDrawer:this.state.bottomDrawer,toggleDrawer:this.toggleDrawer}))}}]),t}(r.Component),U=(n(203),function(e){function t(){return Object(i.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement(O,null),o.a.createElement(I,null))}}]),t}(r.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(o.a.createElement(U,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},48:function(e){e.exports={b:"pk.eyJ1IjoiaGlwcG9seXRlaiIsImEiOiJjamdub2g0cmoyMjZyMndzN3I2eGd4Y3Y3In0.weVb9EjRtuH1lSMFAOqcCA",a:"mapbox://styles/hippolytej/cjgnojfg700a02rp30bjdees6"}},79:function(e,t,n){e.exports=n(205)},84:function(e,t,n){}},[[79,2,1]]]);
//# sourceMappingURL=main.4fbb6d53.chunk.js.map